
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Samesame - Classifier Two-sample Tests">
      
      
        <meta name="author" content="Vathy M. Kamulete">
      
      
        <link rel="canonical" href="https://vathymut.github.io/samesame/examples/credit-example/">
      
      
        <link rel="prev" href="../noninferiority/">
      
      
        <link rel="next" href="../../api/bayes/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Credit example - samesame</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#credit-heloc-dataset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="samesame" class="md-header__button md-logo" aria-label="samesame" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M249.9 66.8c10.4-14.3 7.2-34.3-7.1-44.7s-34.3-7.2-44.7 7.1l-106 145.7-37.5-37.5c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l64 64c6.6 6.6 15.8 10 25.1 9.3s17.9-5.5 23.4-13.1l128-176zm128 136c10.4-14.3 7.2-34.3-7.1-44.7s-34.3-7.2-44.7 7.1l-170 233.7-69.5-69.5c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l96 96c6.6 6.6 15.8 10 25.1 9.3s17.9-5.5 23.4-13.1l192-264z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            samesame
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Credit example
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/vathymut/samesame" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../distribution-shifts/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/bayes/" class="md-tabs__link">
          
  
  
  API

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="samesame" class="md-nav__button md-logo" aria-label="samesame" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M249.9 66.8c10.4-14.3 7.2-34.3-7.1-44.7s-34.3-7.2-44.7 7.1l-106 145.7-37.5-37.5c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l64 64c6.6 6.6 15.8 10 25.1 9.3s17.9-5.5 23.4-13.1l128-176zm128 136c10.4-14.3 7.2-34.3-7.1-44.7s-34.3-7.2-44.7 7.1l-170 233.7-69.5-69.5c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l96 96c6.6 6.6 15.8 10 25.1 9.3s17.9-5.5 23.4-13.1l192-264z"/></svg>

    </a>
    samesame
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vathymut/samesame" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../distribution-shifts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distribution shifts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../noninferiority/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Noninferiority tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Credit example
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Credit example
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#when-to-use-this" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-shift" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset Shift
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset Shift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-importance" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Importance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-degradation" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Degradation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpreting-the-results" class="md-nav__link">
    <span class="md-ellipsis">
      Interpreting the Results
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Key Insights
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Recommendations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/bayes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bayes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/ctst/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ctst
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/nit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#when-to-use-this" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-shift" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset Shift
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset Shift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#feature-importance" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Importance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-degradation" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Degradation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interpreting-the-results" class="md-nav__link">
    <span class="md-ellipsis">
      Interpreting the Results
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Key Insights
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Recommendations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="credit-heloc-dataset">Credit (HELOC) Dataset<a class="headerlink" href="#credit-heloc-dataset" title="Permanent link">&para;</a></h1>
<p>This example demonstrates how <code>samesame</code> can be used on a real-world credit dataset to detect both <strong>dataset shift</strong> (when the data distribution changes between training and deployment) and <strong>performance degradation</strong> (when models make worse predictions). We use the HELOC (Home Equity Line of Credit) dataset from <a href="https://tableshift.org/">TableShift</a>, as described in the <a href="https://tableshift.org/datasets.html#heloc">HELOC dataset documentation</a>.</p>
<h2 id="when-to-use-this">When to use this<a class="headerlink" href="#when-to-use-this" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Dataset shift</strong>: Your training data comes from one population but your model is deployed on a different population. You need to detect when this happens.</li>
<li><strong>Performance monitoring</strong>: You need to know if the model predictions (e.g., default probabilities) have shifted in a harmful (adverse) way over time.</li>
</ul>
<p>This example shows both approaches applied to credit risk scoring.</p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<p>The HELOC dataset comes from the FICO Community Explainable AI Challenge, an open-source dataset containing features derived from anonymized credit bureau data. It includes credit history and risk assessment data. The dataset naturally splits into two populations based on <code>ExternalRiskEstimate</code>:</p>
<ol>
<li><strong>Low credit-risk segment</strong> (<code>External Risk Estimate &gt; 63</code>): Lower risk customers.</li>
<li><strong>High credit-risk segment</strong> (<code>External Risk Estimate ≤ 63</code>): Higher risk customers.</li>
</ol>
<p>We'll treat the low-risk segment as training data and the high-risk segment as a held-out deployment domain, simulating a real-world scenario where a model trained on one population is deployed to a different population with different risk profiles.</p>
<h2 id="dataset-preparation">Dataset Preparation<a class="headerlink" href="#dataset-preparation" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">fetch_openml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">roc_auc_score</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">samesame.ctst</span><span class="w"> </span><span class="kn">import</span> <span class="n">CTST</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">samesame.nit</span><span class="w"> </span><span class="kn">import</span> <span class="n">DSOS</span>

<span class="c1"># Fetch the HELOC dataset from OpenML</span>
<span class="n">fico</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="n">data_id</span><span class="o">=</span><span class="mi">45554</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fico</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">fico</span><span class="o">.</span><span class="n">target</span>

<span class="c1"># Identify the External Risk Estimate column (case-insensitive lookup)</span>
<span class="c1"># This column is used to split the data into two distinct populations</span>
<span class="n">re_obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;external.*risk.*estimate&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
<span class="n">col_candidates</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">re_obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="n">col_split</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">col_candidates</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">if</span> <span class="n">col_split</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;External Risk Estimate column not found&quot;</span><span class="p">)</span>

<span class="c1"># Split data by external risk threshold (63 is the standard cutoff)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mi">63</span>
<span class="n">mask_high</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">col_split</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span>

<span class="c1"># Training domain: low credit-risk customers (high external risk estimates)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">mask_high</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask_high</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Deployment domain: high credit-risk customers (low external risk estimates)</span>
<span class="c1"># This represents the domain shift scenario</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">mask_high</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">mask_high</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training domain: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples (low external risk)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Held-out domain: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples (high external risk)&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Output:</strong></p>
<div class="highlight"><pre><span></span><code># Training domain: 7683 samples (low external risk)
# Held-out domain: 2188 samples (high external risk)
</code></pre></div>
<h2 id="dataset-shift">Dataset Shift<a class="headerlink" href="#dataset-shift" title="Permanent link">&para;</a></h2>
<p><strong>Question</strong>: Are the two domains statistically different?</p>
<p><strong>Method</strong>: We train a classifier to distinguish between the two domains. A high-performing classifier indicates meaningful differences. We use out-of-bag (OOB) predictions to avoid data leakage and obtain valid p-values in keeping with the Classifier Two-Sample Test (CTST) framework.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create binary domain labels: 0 = training, 1 = held-out (deployment)</span>
<span class="n">membership</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
<span class="n">X_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Train a RandomForest classifier to distinguish between domains</span>
<span class="c1"># Key settings:</span>
<span class="c1">#   - oob_score=True: Enables OOB predictions for unbiased model evaluation</span>
<span class="c1">#   - n_estimators=500: Number of trees (higher = more robust estimates)</span>
<span class="c1">#   - min_samples_leaf=10: Minimum samples per leaf (prevents overfitting)</span>
<span class="n">rf_domain</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">12345</span><span class="p">,</span>
    <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">rf_domain</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_concat</span><span class="p">,</span> <span class="n">membership</span><span class="p">)</span>

<span class="c1"># Extract OOB predicted probabilities (probability of being in held-out domain)</span>
<span class="n">oob_scores</span> <span class="o">=</span> <span class="n">rf_domain</span><span class="o">.</span><span class="n">oob_decision_function_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Run Classifier Two-Sample Test (CTST) using AUC as the test metric</span>
<span class="c1"># CTST tests whether the classifier&#39;s discrimination ability is statistically significant</span>
<span class="n">ctst</span> <span class="o">=</span> <span class="n">CTST</span><span class="p">(</span><span class="n">actual</span><span class="o">=</span><span class="n">membership</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">predicted</span><span class="o">=</span><span class="n">oob_scores</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">roc_auc_score</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset Shift Detection (CTST)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Statistic: </span><span class="si">{</span><span class="n">ctst</span><span class="o">.</span><span class="n">statistic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">ctst</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Output:</strong></p>
<div class="highlight"><pre><span></span><code># Dataset Shift Detection (CTST)
#   Statistic: 1.0000
#   p-value: 0.0002
</code></pre></div>
<p><strong>Interpretation</strong>: The p-value = 0.0002 is highly significant (p &lt; 0.05), indicating the training and held-out domains are statistically different. This is expected since we deliberately split the data by risk profile. A classifier that can reliably distinguish between these domains reveals that their underlying feature distributions differ substantially.</p>
<h3 id="feature-importance">Feature Importance<a class="headerlink" href="#feature-importance" title="Permanent link">&para;</a></h3>
<p>To understand <em>which features</em> drive the domain shift, we can examine feature importance:</p>
<div class="highlight"><pre><span></span><code><span class="n">importances</span> <span class="o">=</span> <span class="n">rf_domain</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">X_concat</span><span class="o">.</span><span class="n">columns</span>
<span class="n">feat_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">importances</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 5 features distinguishing the domains:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">feat_imp</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div>
<p><strong>Output:</strong></p>
<div class="highlight"><pre><span></span><code>Top 5 features distinguishing the domains:
ExternalRiskEstimate          0.642400
MSinceMostRecentDelq          0.069394
MaxDelq2PublicRecLast12M      0.064526
NetFractionRevolvingBurden    0.050656
PercentTradesNeverDelq        0.042478
dtype: float64
</code></pre></div>
<p>These features reveal which characteristics differ most between the two populations. <code>ExternalRiskEstimate</code> dominates because it was the splitting criterion. However, other features like <code>MSinceMostRecentDelq</code> and <code>MaxDelq2PublicRecLast12M</code> also show notable importance, indicating the populations differ beyond just the splitting variable. This suggests <strong>covariate shift</strong>: the feature distributions differ, but the label distribution may respond differently.</p>
<h2 id="performance-degradation">Performance Degradation<a class="headerlink" href="#performance-degradation" title="Permanent link">&para;</a></h2>
<p><strong>Question</strong>: Has the model's prediction behavior changed in a way that suggests degradation?</p>
<p><strong>Method</strong>: We train a credit risk model on the training domain to predict loan default (<code>y</code>). Then we compare the model's predicted default probabilities between the training and deployment domains. The Dataset-Shift-with-Outlier-Scores (DSOS) test detects whether the tail of the distribution has shifted, indicating more worse outcomes.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Train a credit risk model on the training domain to predict loan default</span>
<span class="c1"># Convert labels from categorical (Good/Bad) to numeric (0/1)</span>
<span class="n">loan_status</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Good&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bad&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Train RandomForest to predict probability of default</span>
<span class="n">rf_bad</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">12345</span><span class="p">,</span>
    <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">rf_bad</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">loan_status</span><span class="p">)</span>

<span class="c1"># Extract predicted default probabilities</span>
<span class="c1"># - Training domain: Use OOB predictions (unbiased, non-resubstitution)</span>
<span class="c1"># - Deployment domain: Use standard predictions on held-out data</span>
<span class="n">bad_train</span> <span class="o">=</span> <span class="n">rf_bad</span><span class="o">.</span><span class="n">oob_decision_function_</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">bad_test</span> <span class="o">=</span> <span class="n">rf_bad</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="c1"># Apply Degree-of-Shift Outcome-Shift (DSOS) test</span>
<span class="c1"># Tests whether the distribution of predictions has shifted toward worse outcomes</span>
<span class="n">dsos</span> <span class="o">=</span> <span class="n">DSOS</span><span class="o">.</span><span class="n">from_samples</span><span class="p">(</span><span class="n">bad_train</span><span class="p">,</span> <span class="n">bad_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Performance Degradation (DSOS)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Statistic: </span><span class="si">{</span><span class="n">dsos</span><span class="o">.</span><span class="n">statistic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  p-value: </span><span class="si">{</span><span class="n">dsos</span><span class="o">.</span><span class="n">pvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Output:</strong></p>
<div class="highlight"><pre><span></span><code># Performance Degradation (DSOS)
#   Statistic: 0.2483
#   p-value: 0.0001
</code></pre></div>
<p><strong>Interpretation</strong>: The p-value = 0.0001 is highly significant, indicating the model's predicted default probabilities have shifted substantially upward in the deployment domain. This reveals <strong>performance degradation</strong>: the model now predicts higher risk for the new population. Unlike a t-test (which measures mean shift), DSOS focuses on whether the <em>tail</em> of the distribution has shifted, capturing whether more extreme high-risk predictions are now common—the key indicator of adverse performance.</p>
<h2 id="interpreting-the-results">Interpreting the Results<a class="headerlink" href="#interpreting-the-results" title="Permanent link">&para;</a></h2>
<p>In this example, we observe:</p>
<ul>
<li><strong>CTST (p = 0.0002, rejected)</strong>: The held-out domain is significantly different from training. The feature distributions have shifted due to our intentional split by risk profile.</li>
<li><strong>DSOS (p = 0.0001, rejected)</strong>: The model's predicted default probabilities have shifted upward. This indicates <strong>performance degradation</strong>—the model predicts substantially higher risk for the new population, suggesting real concerns about model reliability in production.</li>
<li><strong>Feature importance</strong>: <code>ExternalRiskEstimate</code> dominates, but other features also differ between populations, indicating both direct and indirect covariate shifts.</li>
</ul>
<h2 id="key-insights">Key Insights<a class="headerlink" href="#key-insights" title="Permanent link">&para;</a></h2>
<p><strong>Dataset Shift vs. Performance Degradation.</strong> The CTST and DSOS tests answer complementary questions. CTST tests whether the <em>feature distributions</em> differ between domains—a significant result indicates covariate shift has occurred. DSOS tests whether the <em>model's predictions</em> have shifted toward worse outcomes—a significant result means the model's behavior has degraded. Together, they paint a complete picture: CTST detects whether a problem exists, while DSOS confirms whether it affects your deployed model.</p>
<p><strong>Four Possible Scenarios.</strong> In production, four combinations are possible and each suggests a different action:</p>
<ol>
<li><strong>CTST non-sig, DSOS non-sig</strong>: Domains are similar and the model performs consistently. ✓ Safe to operate.</li>
<li><strong>CTST sig, DSOS non-sig</strong>: Domains differ but the model generalizes well across both. ✓ Monitor closely but no immediate action needed.</li>
<li><strong>CTST sig, DSOS sig</strong>: Domain shift has degraded model performance. ✗ Retrain or recalibrate.</li>
<li><strong>CTST non-sig, DSOS sig</strong>: A subtle shift is affecting predictions despite similar feature distributions. ✗ Investigate underlying causes.</li>
</ol>
<p><strong>Feature-Level Understanding.</strong> Feature importance identifies <em>which</em> specific features drive the shift, enabling targeted interventions. Rather than retraining the entire model, you can focus on recalibration, collecting more data for important features, or implementing domain adaptation techniques on key predictors.</p>
<h2 id="practical-recommendations">Practical Recommendations<a class="headerlink" href="#practical-recommendations" title="Permanent link">&para;</a></h2>
<p><strong>1. Implement Regular Monitoring.</strong> Compute CTST and DSOS on production data batches periodically—monthly or quarterly depending on your deployment frequency and business risk tolerance. Automated pipelines work best: compute statistics continuously and log results for easy review. This early detection enables proactive intervention before performance degrades significantly.</p>
<p><strong>2. Set Clear Action Thresholds.</strong> Define decision rules based on p-values and automate responses. For example: if p &lt; 0.01, trigger alerts and schedule urgent review; if 0.01 ≤ p &lt; 0.05, log the flag and prepare retraining pipelines for review; if p &gt; 0.10, continue normal operation. Document these thresholds and the rationale behind them so all stakeholders understand when and why action is taken.</p>
<p><strong>3. Investigate Root Causes When Tests Are Significant.</strong> Don't just react to test results—understand what's driving them. Compute feature importance from your domain-distinguishing model to identify which features shifted most. Then analyze the actual data: examine distributions, percentiles, and summary statistics for each important feature. Determine whether the shift represents natural business drift (e.g., seasonal patterns, changing customer base) or a data quality issue that needs correction.</p>
<p><strong>4. Choose Metrics That Don't Require Labels.</strong> A major advantage of CTST and DSOS is that they work without true labels in production. Good proxies for monitoring include predicted probabilities (as in this example), model confidence scores, feature distributions, and derived metrics like average predicted default rate. This makes continuous monitoring feasible even when ground truth takes weeks or months to collect.</p>
<p><strong>5. Plan Remediation Based on Severity and Impact.</strong> Once you've identified a significant shift, your response depends on business context. For natural drift over time, simply monitor closely without intervention. For meaningful shifts, consider recalibrating the model to adjust for distribution changes. For substantial shifts affecting business outcomes, retrain on more recent data. In complex scenarios, explore domain adaptation techniques that learn to bridge the gap between training and deployment distributions.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "navigation.expand"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>